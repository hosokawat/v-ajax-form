{"version":3,"file":"v-ajax-form.min.js","sources":["src/components/VAjaxForm.vue","src/main.js"],"sourcesContent":["<template>\n  <form\n    v-bind=\"$attrs\"\n    :action=\"action\"\n    :method=\"method\"\n    @submit.prevent=\"submit\"\n  >\n    <slot></slot>\n  </form>\n</template>\n<script>\nexport default {\n  name: \"VAjaxForm\",\n  inheritAttrs: false,\n  props: {\n    action: {\n      type: String,\n      required: true,\n    },\n    method: {\n      type: String,\n      default: \"GET\",\n      validator: (value) =>\n        [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"].includes(value.toUpperCase()),\n    },\n    uriEncode: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\"start\", \"receive\", \"fail\", \"done\"],\n  methods: {\n    request: function (params) {\n      const vm = this;\n      vm.$emit(\"start\", params);\n\n      const method = vm.method.toUpperCase();\n      let url = vm.action;\n      const options = { method: method };\n\n      if (method === \"GET\") {\n        const query = new URLSearchParams(params).toString();\n        if (query) {\n          url += (url.indexOf(\"?\") >= 0 ? \"&\" : \"?\") + query;\n        }\n      } else if (method === \"POST\") {\n        options.headers = {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n        };\n        options.body = new URLSearchParams(params);\n      } else {\n        options.headers = { \"Content-Type\": \"application/json\" };\n        options.body = JSON.stringify(params);\n      }\n\n      fetch(url, options)\n        .then(function (response) {\n          if (!response.ok) {\n            throw new Error(\"HTTP error! status: \" + response.status);\n          }\n          return response\n            .text()\n            .then(function (text) {\n              try {\n                return JSON.parse(text);\n              } catch (e) {\n                return text;\n              }\n            })\n            .then(function (data) {\n              vm.$emit(\"receive\", {\n                data: data,\n                status: response.status,\n                statusText: response.statusText,\n              });\n            });\n        })\n        .catch(function (error) {\n          vm.$emit(\"fail\", error);\n        })\n        .finally(function () {\n          vm.$emit(\"done\", params);\n        });\n    },\n    submit: function () {\n      let params = {};\n      let vm = this;\n      vm.$el.querySelectorAll(\"input,select,textarea\").forEach(function (el) {\n        if (\n          typeof el.attributes[\"disabled\"] === \"undefined\" &&\n          typeof el.attributes[\"name\"] != \"undefined\"\n        ) {\n          if ((el.type === \"radio\" || el.type === \"checkbox\") && !el.checked)\n            return;\n          let val = el.value;\n          let name = el.attributes[\"name\"].value;\n          if (vm.uriEncode) {\n            val = encodeURIComponent(val);\n            name = encodeURIComponent(name);\n          }\n          if (typeof params[name] === \"undefined\") {\n            params[name] = val;\n          } else if (params[name] instanceof Array) {\n            params[name].push(val);\n          } else {\n            params[name] = [params[name], val];\n          }\n        }\n      });\n      vm.request(params);\n    },\n  },\n};\n</script>\n","import VAjaxForm from \"./components/VAjaxForm.vue\";\n\nconst VAjaxFormPlugin = {\n  install(app) {\n    app.component(\"v-ajax-form\", VAjaxForm);\n  },\n};\n\n// Auto-install when Vue is found (browser)\nif (typeof window !== \"undefined\" && window.Vue && window.Vue.createApp) {\n  // Vue 3のグローバル変数として利用可能にする\n  window.VAjaxForm = VAjaxFormPlugin;\n}\n\nexport default VAjaxFormPlugin;\n"],"names":["_sfc_main","name","inheritAttrs","props","action","type","String","required","method","default","validator","value","includes","toUpperCase","uriEncode","Boolean","emits","methods","request","params","vm","this","$emit","url","options","query","URLSearchParams","toString","indexOf","headers","body","JSON","stringify","fetch","then","response","ok","Error","status","text","parse","e","data","statusText","catch","error","finally","submit","$el","querySelectorAll","forEach","el","attributes","checked","val","encodeURIComponent","Array","push","_createElementBlock","createElementBlock","_mergeProps","mergeProps","_ctx","$attrs","$props","onSubmit","$options","args","_renderSlot","$slots","VAjaxFormPlugin","install","app","component","VAjaxForm","window","Vue","createApp"],"mappings":"uCAWA,MAAKA,EAAU,CACbC,KAAM,YACNC,cAAc,EACdC,MAAO,CACLC,OAAQ,CACNC,KAAMC,OACNC,UAAU,GAEZC,OAAQ,CACNH,KAAMC,OACNG,QAAS,MACTC,UAAYC,GACV,CAAC,MAAO,OAAQ,MAAO,SAAU,SAASC,SAASD,EAAME,gBAE7DC,UAAW,CACTT,KAAMU,QACNN,SAAS,IAGbO,MAAO,CAAC,QAAS,UAAW,OAAQ,QACpCC,QAAS,CACPC,QAAS,SAAUC,GACjB,MAAMC,EAAKC,KACXD,EAAGE,MAAM,QAASH,GAElB,MAAMX,EAASY,EAAGZ,OAAOK,cACzB,IAAIU,EAAMH,EAAGhB,OACb,MAAMoB,EAAU,CAAEhB,OAAQA,GAE1B,GAAe,QAAXA,EAAkB,CACpB,MAAMiB,EAAQ,IAAIC,gBAAgBP,GAAQQ,WACtCF,IACFF,IAAQA,EAAIK,QAAQ,MAAQ,EAAI,IAAM,KAAOH,OAE3B,SAAXjB,GACTgB,EAAQK,QAAU,CAChB,eAAgB,qCAElBL,EAAQM,KAAO,IAAIJ,gBAAgBP,KAEnCK,EAAQK,QAAU,CAAE,eAAgB,oBACpCL,EAAQM,KAAOC,KAAKC,UAAUb,IAGhCc,MAAMV,EAAKC,GACRU,MAAK,SAAUC,GACd,IAAKA,EAASC,GACZ,MAAM,IAAIC,MAAM,uBAAyBF,EAASG,QAEpD,OAAOH,EACJI,OACAL,MAAK,SAAUK,GACd,IACE,OAAOR,KAAKS,MAAMD,EACpB,CAAE,MAAOE,GACP,OAAOF,CACT,CACD,IACAL,MAAK,SAAUQ,GACdtB,EAAGE,MAAM,UAAW,CAClBoB,KAAMA,EACNJ,OAAQH,EAASG,OACjBK,WAAYR,EAASQ,YAEzB,GACH,IACAC,OAAM,SAAUC,GACfzB,EAAGE,MAAM,OAAQuB,EAClB,IACAC,SAAQ,WACP1B,EAAGE,MAAM,OAAQH,EACnB,GACH,EACD4B,OAAQ,WACN,IAAI5B,EAAS,CAAE,EACXC,EAAKC,KACTD,EAAG4B,IAAIC,iBAAiB,yBAAyBC,SAAQ,SAAUC,GACjE,QACuC,IAA9BA,EAAGC,WAAqB,eACC,IAAzBD,EAAGC,WAAiB,KAC3B,CACA,IAAiB,UAAZD,EAAG9C,MAAgC,aAAZ8C,EAAG9C,QAAyB8C,EAAGE,QACzD,OACF,IAAIC,EAAMH,EAAGxC,MACTV,EAAOkD,EAAGC,WAAiB,KAAEzC,MAC7BS,EAAGN,YACLwC,EAAMC,mBAAmBD,GACzBrD,EAAOsD,mBAAmBtD,SAEA,IAAjBkB,EAAOlB,GAChBkB,EAAOlB,GAAQqD,EACNnC,EAAOlB,aAAiBuD,MACjCrC,EAAOlB,GAAMwD,KAAKH,GAElBnC,EAAOlB,GAAQ,CAACkB,EAAOlB,GAAOqD,EAElC,CACF,IACAlC,EAAGF,QAAQC,EACZ,6JA7GHuC,EAOOC,mBAAA,OAPPC,EAOOC,WANGC,EAAMC,OAAA,CACb3D,OAAQ4D,EAAM5D,OACdI,OAAQwD,EAAMxD,OACdyD,8CAAgBC,EAAMnB,QAAAmB,EAAAnB,UAAAoB,IAAA,CAAA,gBAEvBC,aAAaN,EAAAO,OAAA,sBCLZ,MAACC,EAAkB,CACtB,OAAAC,CAAQC,GACNA,EAAIC,UAAU,cAAeC,EAC9B,SAImB,oBAAXC,QAA0BA,OAAOC,KAAOD,OAAOC,IAAIC,YAE5DF,OAAOD,UAAYJ"}