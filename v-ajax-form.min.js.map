{"version":3,"file":"v-ajax-form.min.js","sources":["src/components/VAjaxForm.vue","src/main.js"],"sourcesContent":["<template>\n  <form\n    ref=\"formRef\"\n    v-bind=\"$attrs\"\n    :action=\"action\"\n    :method=\"method\"\n    @submit.prevent=\"submit\"\n  >\n    <slot></slot>\n  </form>\n</template>\n<script setup>\nimport { ref } from \"vue\";\n\nconst props = defineProps({\n  action: {\n    type: String,\n    required: true,\n  },\n  method: {\n    type: String,\n    default: \"GET\",\n    validator: (value) =>\n      [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"].includes(value.toUpperCase()),\n  },\n  uriEncode: {\n    type: Boolean,\n    default: false,\n  },\n});\n\nconst emit = defineEmits([\"start\", \"receive\", \"fail\", \"done\"]);\n\ndefineOptions({\n  name: \"VAjaxForm\",\n  inheritAttrs: false,\n});\n\n// テンプレート参照をフォールバックとして用意\nconst formRef = ref(null);\n\nconst request = async (params) => {\n  emit(\"start\", params);\n\n  const method = props.method.toUpperCase();\n  let url = props.action;\n  const options = { method: method };\n\n  if (method === \"GET\") {\n    const query = new URLSearchParams(params).toString();\n    if (query) {\n      url += (url.indexOf(\"?\") >= 0 ? \"&\" : \"?\") + query;\n    }\n  } else if (method === \"POST\") {\n    options.headers = {\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n    };\n    options.body = new URLSearchParams(params);\n  } else {\n    options.headers = { \"Content-Type\": \"application/json\" };\n    options.body = JSON.stringify(params);\n  }\n\n  try {\n    const response = await fetch(url, options);\n\n    if (!response.ok) {\n      throw new Error(\"HTTP error! status: \" + response.status);\n    }\n\n    const text = await response.text();\n    let data;\n    try {\n      data = JSON.parse(text);\n    } catch (e) {\n      data = text;\n    }\n\n    emit(\"receive\", {\n      data: data,\n      status: response.status,\n      statusText: response.statusText,\n    });\n  } catch (error) {\n    emit(\"fail\", error);\n  } finally {\n    emit(\"done\", params);\n  }\n};\n\nconst submit = () => {\n  const params = {};\n\n  const form = formRef.value;\n\n  if (!form) {\n    console.warn(\"VAjaxForm: Could not access form element\");\n    return;\n  }\n\n  form.querySelectorAll(\"input,select,textarea\").forEach((el) => {\n    if (\n      typeof el.attributes[\"disabled\"] === \"undefined\" &&\n      typeof el.attributes[\"name\"] != \"undefined\"\n    ) {\n      if ((el.type === \"radio\" || el.type === \"checkbox\") && !el.checked)\n        return;\n      let val = el.value;\n      let name = el.attributes[\"name\"].value;\n      if (props.uriEncode) {\n        val = encodeURIComponent(val);\n        name = encodeURIComponent(name);\n      }\n      if (typeof params[name] === \"undefined\") {\n        params[name] = val;\n      } else if (params[name] instanceof Array) {\n        params[name].push(val);\n      } else {\n        params[name] = [params[name], val];\n      }\n    }\n  });\n  request(params);\n};\n</script>\n","import VAjaxForm from \"./components/VAjaxForm.vue\";\n\nconst VAjaxFormPlugin = {\n  install(app) {\n    app.component(\"v-ajax-form\", VAjaxForm);\n  },\n};\n\n// Auto-install when Vue is found (browser)\nif (typeof window !== \"undefined\" && window.Vue && window.Vue.createApp) {\n  // Vue 3のグローバル変数として利用可能にする\n  window.VAjaxForm = VAjaxFormPlugin;\n}\n\nexport default VAjaxFormPlugin;\n"],"names":["props","__props","emit","__emit","formRef","ref","submit","params","form","value","querySelectorAll","forEach","el","attributes","type","checked","val","name","uriEncode","encodeURIComponent","Array","push","async","method","toUpperCase","url","action","options","query","URLSearchParams","toString","indexOf","headers","body","JSON","stringify","response","fetch","ok","Error","status","text","data","parse","e","statusText","error","request","console","warn","_openBlock","_createElementBlock","_mergeProps","$attrs","onSubmit","_renderSlot","_ctx","$slots","VAjaxFormPlugin","install","app","component","VAjaxForm","window","Vue","createApp"],"mappings":"iYAcA,MAAMA,EAAQC,EAiBRC,EAAOC,EAQPC,EAAUC,EAAGA,IAAC,MAmDdC,EAAS,KACb,MAAMC,EAAS,CAAE,EAEXC,EAAOJ,EAAQK,MAEhBD,GAKLA,EAAKE,iBAAiB,yBAAyBC,SAASC,IACtD,QACuC,IAA9BA,EAAGC,WAAqB,eACC,IAAzBD,EAAGC,WAAiB,KAC3B,CACA,IAAiB,UAAZD,EAAGE,MAAgC,aAAZF,EAAGE,QAAyBF,EAAGG,QACzD,OACF,IAAIC,EAAMJ,EAAGH,MACTQ,EAAOL,EAAGC,WAAiB,KAAEJ,MAC7BT,EAAMkB,YACRF,EAAMG,mBAAmBH,GACzBC,EAAOE,mBAAmBF,SAEA,IAAjBV,EAAOU,GAChBV,EAAOU,GAAQD,EACNT,EAAOU,aAAiBG,MACjCb,EAAOU,GAAMI,KAAKL,GAElBT,EAAOU,GAAQ,CAACV,EAAOU,GAAOD,EAEtC,KA/EgBM,OAAOf,IACrBL,EAAK,QAASK,GAEd,MAAMgB,EAASvB,EAAMuB,OAAOC,cAC5B,IAAIC,EAAMzB,EAAM0B,OAChB,MAAMC,EAAU,CAAEJ,OAAQA,GAE1B,GAAe,QAAXA,EAAkB,CACpB,MAAMK,EAAQ,IAAIC,gBAAgBtB,GAAQuB,WACtCF,IACFH,IAAQA,EAAIM,QAAQ,MAAQ,EAAI,IAAM,KAAOH,EAEnD,KAAwB,SAAXL,GACTI,EAAQK,QAAU,CAChB,eAAgB,qCAElBL,EAAQM,KAAO,IAAIJ,gBAAgBtB,KAEnCoB,EAAQK,QAAU,CAAE,eAAgB,oBACpCL,EAAQM,KAAOC,KAAKC,UAAU5B,IAGhC,IACE,MAAM6B,QAAiBC,MAAMZ,EAAKE,GAElC,IAAKS,EAASE,GACZ,MAAM,IAAIC,MAAM,uBAAyBH,EAASI,QAGpD,MAAMC,QAAaL,EAASK,OAC5B,IAAIC,EACJ,IACEA,EAAOR,KAAKS,MAAMF,EACnB,CAAC,MAAOG,GACPF,EAAOD,CACb,CAEIvC,EAAK,UAAW,CACdwC,KAAMA,EACNF,OAAQJ,EAASI,OACjBK,WAAYT,EAASS,YAExB,CAAC,MAAOC,GACP5C,EAAK,OAAQ4C,EACjB,CAAY,QACR5C,EAAK,OAAQK,EACjB,GAmCEwC,CAAQxC,IA1BNyC,QAAQC,KAAK,2DA/FfC,cAAAC,qBAQO,OARPC,EAAAA,WAQO,SAPD,UAAJ/C,IAAID,GACIiD,EAAMA,OAAA,CACb3B,OAAQzB,EAAMyB,OACdH,OAAQtB,EAAMsB,OACd+B,yBAAgBhD,EAAM,CAAA,eAEvBiD,aAAaC,EAAAC,OAAA,sBCNXC,EAAkB,CACtB,OAAAC,CAAQC,GACNA,EAAIC,UAAU,cAAeC,EAC9B,SAImB,oBAAXC,QAA0BA,OAAOC,KAAOD,OAAOC,IAAIC,YAE5DF,OAAOD,UAAYJ"}