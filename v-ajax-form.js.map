{"version":3,"file":"v-ajax-form.js","sources":["src/components/VAjaxForm.vue","src/main.js"],"sourcesContent":["<template>\n  <form\n    v-bind=\"$attrs\"\n    :action=\"action\"\n    :method=\"method\"\n    @submit.prevent=\"submit\"\n  >\n    <slot></slot>\n  </form>\n</template>\n<script>\nexport default {\n  name: \"VAjaxForm\",\n  inheritAttrs: false,\n  props: {\n    action: {\n      type: String,\n      required: true,\n    },\n    method: {\n      type: String,\n      default: \"GET\",\n      validator: (value) =>\n        [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"].includes(value.toUpperCase()),\n    },\n    uriEncode: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\"start\", \"receive\", \"fail\", \"done\"],\n  methods: {\n    request: async function (params) {\n      const vm = this;\n      vm.$emit(\"start\", params);\n\n      const method = vm.method.toUpperCase();\n      let url = vm.action;\n      const options = { method: method };\n\n      if (method === \"GET\") {\n        const query = new URLSearchParams(params).toString();\n        if (query) {\n          url += (url.indexOf(\"?\") >= 0 ? \"&\" : \"?\") + query;\n        }\n      } else if (method === \"POST\") {\n        options.headers = {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n        };\n        options.body = new URLSearchParams(params);\n      } else {\n        options.headers = { \"Content-Type\": \"application/json\" };\n        options.body = JSON.stringify(params);\n      }\n\n      try {\n        const response = await fetch(url, options);\n\n        if (!response.ok) {\n          throw new Error(\"HTTP error! status: \" + response.status);\n        }\n\n        const text = await response.text();\n        let data;\n        try {\n          data = JSON.parse(text);\n        } catch (e) {\n          data = text;\n        }\n\n        vm.$emit(\"receive\", {\n          data: data,\n          status: response.status,\n          statusText: response.statusText,\n        });\n      } catch (error) {\n        vm.$emit(\"fail\", error);\n      } finally {\n        vm.$emit(\"done\", params);\n      }\n    },\n    submit: function () {\n      let params = {};\n      let vm = this;\n      vm.$el.querySelectorAll(\"input,select,textarea\").forEach(function (el) {\n        if (\n          typeof el.attributes[\"disabled\"] === \"undefined\" &&\n          typeof el.attributes[\"name\"] != \"undefined\"\n        ) {\n          if ((el.type === \"radio\" || el.type === \"checkbox\") && !el.checked)\n            return;\n          let val = el.value;\n          let name = el.attributes[\"name\"].value;\n          if (vm.uriEncode) {\n            val = encodeURIComponent(val);\n            name = encodeURIComponent(name);\n          }\n          if (typeof params[name] === \"undefined\") {\n            params[name] = val;\n          } else if (params[name] instanceof Array) {\n            params[name].push(val);\n          } else {\n            params[name] = [params[name], val];\n          }\n        }\n      });\n      vm.request(params);\n    },\n  },\n};\n</script>\n","import VAjaxForm from \"./components/VAjaxForm.vue\";\n\nconst VAjaxFormPlugin = {\n  install(app) {\n    app.component(\"v-ajax-form\", VAjaxForm);\n  },\n};\n\n// Auto-install when Vue is found (browser)\nif (typeof window !== \"undefined\" && window.Vue && window.Vue.createApp) {\n  // Vue 3のグローバル変数として利用可能にする\n  window.VAjaxForm = VAjaxFormPlugin;\n}\n\nexport default VAjaxFormPlugin;\n"],"names":["_createElementBlock","_mergeProps","_renderSlot"],"mappings":";;;;;;;;;;;EAWA,MAAK,SAAU,GAAA;EACb,EAAA,IAAI,EAAE,WAAW;EACjB,EAAA,YAAY,EAAE,KAAK;EACnB,EAAA,KAAK,EAAE;EACL,IAAA,MAAM,EAAE;QACN,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;OACf;EACD,IAAA,MAAM,EAAE;QACN,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,KAAK;EACd,MAAA,SAAS,EAAE,CAAC,KAAK;EACf,QAAA,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;OAC1E;MACD,SAAS,EAAE;QACT,IAAI,EAAE,OAAO;QACb,OAAO,EAAE,KAAK;OACf;KACF;EACD,EAAA,KAAK,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,CAAC;EAC3C,EAAA,OAAO,EAAE;MACP,OAAO,EAAE,gBAAgB,MAAM,EAAE;QAC/B,MAAM,KAAK,IAAI;QACf,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC;;EAEzB,MAAA,MAAM,MAAO,GAAE,EAAE,CAAC,MAAM,CAAC,WAAW,EAAE;EACtC,MAAA,IAAI,MAAM,EAAE,CAAC,MAAM;QACnB,MAAM,OAAM,GAAI,EAAE,MAAM,EAAE,MAAK,EAAG;;EAElC,MAAA,IAAI,MAAK,KAAM,KAAK,EAAE;UACpB,MAAM,KAAM,GAAE,IAAI,eAAe,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE;EACpD,QAAA,IAAI,KAAK,EAAE;EACT,UAAA,GAAI,IAAG,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAA,IAAK,CAAA,GAAI,GAAI,GAAE,GAAG,IAAI,KAAK;EACpD;SACA,MAAK,IAAI,MAAO,KAAI,MAAM,EAAE;EAC5B,QAAA,OAAO,CAAC,UAAU;YAChB,cAAc,EAAE,mCAAmC;WACpD;EACD,QAAA,OAAO,CAAC,OAAO,IAAI,eAAe,CAAC,MAAM,CAAC;SAC1C,MAAK;UACL,OAAO,CAAC,OAAM,GAAI,EAAE,cAAc,EAAE,kBAAiB,EAAG;EACxD,QAAA,OAAO,CAAC,IAAG,GAAI,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;EACvC;;EAEA,MAAA,IAAI;EACF,QAAA,MAAM,QAAO,GAAI,MAAM,KAAK,CAAC,GAAG,EAAE,OAAO,CAAC;;EAE1C,QAAA,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;YAChB,MAAM,IAAI,KAAK,CAAC,sBAAuB,GAAE,QAAQ,CAAC,MAAM,CAAC;EAC3D;;EAEA,QAAA,MAAM,IAAG,GAAI,MAAM,QAAQ,CAAC,IAAI,EAAE;EAClC,QAAA,IAAI,IAAI;EACR,QAAA,IAAI;EACF,UAAA,IAAG,GAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;EACzB,SAAA,CAAE,OAAO,CAAC,EAAE;EACV,UAAA,IAAG,GAAI,IAAI;EACb;;EAEA,QAAA,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE;EAClB,UAAA,IAAI,EAAE,IAAI;YACV,MAAM,EAAE,QAAQ,CAAC,MAAM;EACvB,UAAA,UAAU,EAAE,QAAQ,CAAC,UAAU;EACjC,SAAC,CAAC;SACF,CAAA,OAAO,KAAK,EAAE;UACd,EAAE,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC;EACzB,OAAA,SAAU;UACR,EAAE,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,CAAC;EAC1B;OACD;EACD,IAAA,MAAM,EAAE,YAAY;QAClB,IAAI,MAAK,GAAI,EAAE;QACf,IAAI,EAAC,GAAI,IAAI;EACb,MAAA,EAAE,CAAC,GAAG,CAAC,gBAAgB,CAAC,uBAAuB,CAAC,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE;EACrE,QAAA;YACE,OAAO,EAAE,CAAC,UAAU,CAAC,UAAU,CAAE,KAAI;EACrC,UAAA,OAAO,EAAE,CAAC,UAAU,CAAC,MAAM,KAAK;YAChC;YACA,IAAI,CAAC,EAAE,CAAC,IAAG,KAAM,OAAQ,IAAG,EAAE,CAAC,IAAK,KAAI,UAAU,KAAK,CAAC,EAAE,CAAC,OAAO;EAChE,YAAA;EACF,UAAA,IAAI,GAAI,GAAE,EAAE,CAAC,KAAK;EAClB,UAAA,IAAI,IAAK,GAAE,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,KAAK;EACtC,UAAA,IAAI,EAAE,CAAC,SAAS,EAAE;cAChB,GAAI,GAAE,kBAAkB,CAAC,GAAG,CAAC;cAC7B,IAAG,GAAI,kBAAkB,CAAC,IAAI,CAAC;EACjC;EACA,UAAA,IAAI,OAAO,MAAM,CAAC,IAAI,CAAE,KAAI,WAAW,EAAE;EACvC,YAAA,MAAM,CAAC,IAAI,CAAA,GAAI,GAAG;EACpB,WAAA,MAAO,IAAI,MAAM,CAAC,IAAI,CAAA,YAAa,KAAK,EAAE;cACxC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC;aACtB,MAAK;EACL,YAAA,MAAM,CAAC,IAAI,CAAE,GAAE,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC;EACpC;EACF;EACF,OAAC,CAAC;EACF,MAAA,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC;OACnB;KACF;EACH,CAAC;;;;;6BA5GCA,sBAOO,CAAA,MAAA,EAPPC,cAOO,CANG,IAAM,CAAA,MAAA,EAAA;EACb,IAAA,MAAM,EAAE,MAAM,CAAA,MAAA;EACd,IAAA,MAAM,EAAE,MAAM,CAAA,MAAA;EACd,IAAA,QAAM,4DAAU,QAAM,CAAA,MAAA,IAAA,QAAA,CAAA,MAAA,CAAA,GAAA,IAAA,CAAA,CAAA,EAAA,CAAA,SAAA,CAAA,CAAA;;MAEvBC,cAAa,CAAA,IAAA,CAAA,MAAA,EAAA,SAAA;;;;;ACLZ,QAAC,eAAe,GAAG;EACxB,EAAE,OAAO,CAAC,GAAG,EAAE;EACf,IAAI,GAAG,CAAC,SAAS,CAAC,aAAa,EAAE,SAAS,CAAC;EAC3C,GAAG;EACH;;EAEA;EACA,IAAI,OAAO,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,SAAS,EAAE;EACzE;EACA,EAAE,MAAM,CAAC,SAAS,GAAG,eAAe;EACpC;;;;;;;;"}