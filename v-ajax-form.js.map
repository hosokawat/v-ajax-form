{"version":3,"file":"v-ajax-form.js","sources":["src/components/VAjaxForm.vue","src/main.js"],"sourcesContent":["<template>\n  <form\n    ref=\"formRef\"\n    v-bind=\"$attrs\"\n    :action=\"action\"\n    :method=\"method\"\n    @submit.prevent=\"submit\"\n  >\n    <slot></slot>\n  </form>\n</template>\n<script setup>\nimport { ref, computed } from \"vue\";\n\nconst props = defineProps({\n  action: {\n    type: String,\n    required: true,\n  },\n  method: {\n    type: String,\n    default: \"GET\",\n    validator: (value) =>\n      [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"].includes(value.toUpperCase()),\n  },\n  uriEncode: {\n    type: Boolean,\n    default: false,\n  },\n});\n\nconst emit = defineEmits([\"start\", \"receive\", \"fail\", \"done\"]);\n\ndefineOptions({\n  name: \"VAjaxForm\",\n  inheritAttrs: false,\n});\n\n// テンプレート参照をフォールバックとして用意\nconst formRef = ref(null);\n\n// ファイル入力があるかどうかを判定\nconst hasFileInputs = computed(() => {\n  return formRef.value?.querySelector('input[type=\"file\"]') !== null;\n});\n\nconst request = async (params) => {\n  emit(\"start\", params);\n\n  try {\n    const method = props.method.toUpperCase();\n    let url = props.action;\n    const options = { method: method };\n\n    if (method === \"GET\") {\n      // ファイルアップロードの場合はGETメソッドは使用できない\n      if (params instanceof FormData) {\n        throw new Error(\"File uploads are not supported with GET method\");\n      }\n      const query = new URLSearchParams(params).toString();\n      if (query) {\n        url += (url.indexOf(\"?\") >= 0 ? \"&\" : \"?\") + query;\n      }\n    } else if (method === \"POST\") {\n      if (params instanceof FormData) {\n        // FormDataの場合はContent-Typeヘッダーを設定しない（ブラウザが自動設定）\n        options.body = params;\n      } else {\n        options.headers = {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n        };\n        options.body = new URLSearchParams(params);\n      }\n    } else {\n      if (params instanceof FormData) {\n        // PUT, DELETE, PATCHでもFormDataをサポート\n        options.body = params;\n      } else {\n        options.headers = { \"Content-Type\": \"application/json\" };\n        options.body = JSON.stringify(params);\n      }\n    }\n\n    const response = await fetch(url, options);\n\n    if (!response.ok) {\n      throw new Error(\"HTTP error! status: \" + response.status);\n    }\n\n    const text = await response.text();\n    let data;\n    try {\n      data = JSON.parse(text);\n    } catch (e) {\n      data = text;\n    }\n\n    emit(\"receive\", {\n      data: data,\n      status: response.status,\n      statusText: response.statusText,\n    });\n  } catch (error) {\n    emit(\"fail\", error);\n  } finally {\n    emit(\"done\", params);\n  }\n};\n\nconst collectFormData = () => {\n  const form = formRef.value;\n\n  if (!form) {\n    console.warn(\"VAjaxForm: Could not access form element\");\n    return null;\n  }\n\n  // ファイル入力がある場合はFormDataを使用\n  if (hasFileInputs.value) {\n    const formData = new FormData();\n    \n    form.querySelectorAll(\"input,select,textarea\").forEach((el) => {\n      if (\n        typeof el.attributes[\"disabled\"] === \"undefined\" &&\n        typeof el.attributes[\"name\"] !== \"undefined\"\n      ) {\n        const name = el.attributes[\"name\"].value;\n        \n        if (el.type === \"file\") {\n          // ファイル入力の処理\n          Array.from(el.files || []).forEach((file) => {\n            formData.append(name, file);\n          });\n        } else if ((el.type === \"radio\" || el.type === \"checkbox\") && !el.checked) {\n          return;\n        } else {\n          let val = el.value;\n          if (props.uriEncode) {\n            val = encodeURIComponent(val);\n          }\n          formData.append(props.uriEncode ? encodeURIComponent(name) : name, val);\n        }\n      }\n    });\n    \n    return formData;\n  } else {\n    // 通常のフォームデータ処理\n    const params = {};\n    \n    form.querySelectorAll(\"input,select,textarea\").forEach((el) => {\n      if (\n        typeof el.attributes[\"disabled\"] === \"undefined\" &&\n        typeof el.attributes[\"name\"] !== \"undefined\"\n      ) {\n        if ((el.type === \"radio\" || el.type === \"checkbox\") && !el.checked)\n          return;\n        let val = el.value;\n        let name = el.attributes[\"name\"].value;\n        if (props.uriEncode) {\n          val = encodeURIComponent(val);\n          name = encodeURIComponent(name);\n        }\n        if (typeof params[name] === \"undefined\") {\n          params[name] = val;\n        } else if (params[name] instanceof Array) {\n          params[name].push(val);\n        } else {\n          params[name] = [params[name], val];\n        }\n      }\n    });\n    \n    return params;\n  }\n};\n\nconst submit = async () => {\n  const formData = collectFormData();\n  if (formData !== null) {\n    await request(formData);\n  }\n};\n</script>\n","import VAjaxForm from \"./components/VAjaxForm.vue\";\n\nconst VAjaxFormPlugin = {\n  install(app) {\n    app.component(\"v-ajax-form\", VAjaxForm);\n  },\n};\n\n// Auto-install when Vue is found (browser)\nif (typeof window !== \"undefined\" && window.Vue && window.Vue.createApp) {\n  // Vue 3のグローバル変数として利用可能にする\n  window.VAjaxForm = VAjaxFormPlugin;\n}\n\nexport default VAjaxFormPlugin;\n"],"names":["ref","computed","_openBlock","_createElementBlock","_mergeProps","$attrs","_renderSlot","VAjaxForm"],"mappings":"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"}